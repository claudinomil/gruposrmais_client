<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Title</title>
        <style>
            #map {
                height: 600px;
                width: 100%;
                margin-bottom: 1rem;
            }
            button {
                padding: 10px 20px;
                font-size: 16px;
            }
        </style>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARmoDmjUAPxUg4J5Ztuq1ceSqZK6i3WbM"></script>
        <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <button onclick="captureMap()">Capturar imagem</button>

        <script>
            async function initMap() {
            	const response = await fetch('/build/assets/ocorrencias.json');
            	const ocorrencias = await response.json();

            	const map = new google.maps.Map(document.getElementById("map"), {
            		zoom: 11,
                    center: { lat: -22.9068, lng: -43.1729 }
            	});

            	ocorrencias.forEach(o => {
            		const iconUrl = o.tipo === "Obra" ? "https://maps.google.com/mapfiles/ms/icons/orange-dot.png" :
                        o.tipo === "OcorrÃªncia Policial" ? "https://maps.google.com/mapfiles/ms/icons/blue-dot.png" :
                            "https://maps.google.com/mapfiles/ms/icons/red-dot.png";

            		new google.maps.Marker({
                        position: { lat: o.latitude, lng: o.longitude },
                        map: map,
                        title: `${o.tipo}: ${o.descricao}`,
                        icon: o.icone // usa diretamente do JSON
            		});
            	});
            }

            function captureMap() {
            	html2canvas(document.getElementById("map")).then(canvas => {
            		const link = document.createElement("a");
            		link.download = "mapa_ocorrencias.png";
            		link.href = canvas.toDataURL();
            		link.click();
            	});
            }

            window.onload = initMap;
        </script>
    </body>
</html>
